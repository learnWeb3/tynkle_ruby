<% if session[:device_category].to_i > 0  && session[:problem_type].to_i > 0 %>

<section class="container mt-4">

        <h2 class="text-center">Poster une demande</h2>

        <div class="progress d-none d-md-none d-lg-flex">
            <div class="progress-bar bg-success" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><%=button_to "Type d'appareil", wizard_path(:device_type), class:"text-white bg-transparent border-0", method: :get%></div>
            <div class="progress-bar bg-success" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><%=button_to "De quoi s'agit-il", wizard_path(:problem_type), class:"text-white bg-transparent border-0", method: :get%></div>

            <% if session[:device_category].nil? && session[:problem_type].nil? %>
                <div class="progress-bar progress-bar" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><%=button_to "Rediger ma demande", wizard_path(:fill_up_mission_details), class:"text-white bg-transparent border-0", method: :get, disabled:true%></div>
                <div class="progress-bar progress-bar bg-light" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><%=button_to "Selectionner mes Helpers", wizard_path(:select_helper), class:"text-dark bg-transparent border-0", method: :get, disabled:true%></div>
            <% else %>
                <div class="progress-bar progress-bar" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><%=button_to "Rediger ma demande", wizard_path(:fill_up_mission_details), class:"text-white bg-transparent border-0", method: :get%></div>
                <div class="progress-bar progress-bar bg-light" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><%=button_to "Selectionner mes Helpers", wizard_path(:select_helper), class:"text-dark bg-transparent border-0", method: :get%></div>
            <% end %>

            <% if session[:mission].nil?%>
                <div class="progress-bar progress-bar bg-light" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><%=button_to "Merci", wizard_path(:finish), class:"text-dark bg-transparent border-0", method: :get, disabled: true%></div>
            <% else %>
                <div class="progress-bar progress-bar bg-light" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><%=button_to "Merci", wizard_path(:finish), class:"text-dark bg-transparent border-0", method: :get%></div>
            <% end %>
        </div>
      
        <div class="progress d-none d-md-flex d-sm-flex d-md-none d-lg-none">
            <div class="progress-bar bg-success" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><%=button_to "1", wizard_path(:device_type), class:"text-white bg-transparent border-0", method: :get%></div>
            <div class="progress-bar bg-success" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><%=button_to "2", wizard_path(:problem_type), class:"text-dark bg-transparent border-0", method: :get%></div>
            
            <% if session[:device_category].nil? && session[:problem_type].nil? %>
                <div class="progress-bar progress-bar" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><%=button_to "3", wizard_path(:fill_up_mission_details), class:"text-dark bg-transparent border-0", method: :get, disabled:true%></div>
                <div class="progress-bar progress-bar bg-light" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><%=button_to "4", wizard_path(:select_helper), class:"text-dark bg-transparent border-0", method: :get, disabled:true%></div>
            <% else %>
                <div class="progress-bar progress-bar" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><%=button_to "3", wizard_path(:fill_up_mission_details), class:"text-dark bg-transparent border-0", method: :get%></div>
                <div class="progress-bar progress-bar bg-light" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><%=button_to "4", wizard_path(:select_helper), class:"text-dark bg-transparent border-0", method: :get%></div>
            <% end %>
           
            <% if session[:mission].nil? %>
                <div class="progress-bar progress-bar bg-light" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><%=button_to "5", wizard_path(:finish), class:"text-dark bg-transparent border-0", method: :get, disabled: true%></div>
            <% else %>
                <div class="progress-bar progress-bar bg-light" role="progressbar" style="width: 20%;" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><%=button_to "5", wizard_path(:finish), class:"text-dark bg-transparent border-0", method: :get%></div>
            <% end %>
        </div>
      

        <div class="row justify-content-center my-3 py-4 bg-light-grey">

            <div class="col-9">

                <%= form_for @mission, url: missions_path, method: :post do |f| %>

                    <div class="row">
                        <div class="col">


                        <div class="form-group col-12">
                            <%=  f.label :"Type d'Appareil :" %>
                            <%=  f.text_field :title, class:"form-control mb-4", value:@device_category.title, disabled:true  %>
                        </div>

                        </div>

                        <div class="col">

                        <div class="form-group col-12">
                            <%=  f.label :"Catégorie :" %>
                            <%=  f.text_field :title, class:"form-control mb-4", value:@problem_type.name, disabled:true  %>
                        </div>

                        </div>

            
                    </div>

                    <div class="row">

                        <div class="col">
                            <div class="form-group col">
                                <%=  f.label :"Titre_de_la_demande :" %>
                                <%=  f.text_field :title, class:"form-control mb-4"  %>
                            </div>

                        </div>

                        <div class="col">

                            <div class="form-group col-12">
                            <%=  f.label :"Budget :" %>
                            <%=  f.number_field :price, class:"form-control"  %>
                            </div>
                        </div>
                    </div>

                    <div class="form-group col-12">
                        <%=  f.label :"Description_de_la_demande :"%>
                        <%=  f.text_area :description, class:"form-control mb-4", rows:"10"  %>
                    </div>


                    <div class="form-group col-12">
                        <%=  f.label :"Localisation :" %>
                        <%=  f.text_field :address, class:"form-control", id:"autocomplete_address"   %>
                        <small class="form-text text-muted">Nous t'aidons en utlisant Google Maps pour une géolocalisation plus précise.</small>
                    </div>


                   
                <div class="form-group col-12">
                    <%=  f.label :"Ajouter des fichiers :" %>
                    
                    <div class="row">
                        <div class="col">
                        <%=  f.file_field :image_one, class:"form-control-file mb-4"  %>
                        </div>
                        <div class="col">
                        <%=  f.file_field :image_two, class:"form-control-file mb-4"  %>
                        </div>
                        <div class="col">
                        <%=  f.file_field :image_three, class:"form-control-file mb-4"  %>
                        </div>
                    </div>

                </div>


                <% unless user_signed_in? %>


                <hr class="my-4">

                <h5> Identité : </h5>

                <%=f.fields_for :@user do |ff| %>


                        <div class="form-group col-6 mx-auto">
                            <%=  ff.label :"Adresse email :"%>
                            <%=  ff.email_field :email, class:"form-control mb-4"%>
                        </div>

                        <div class="form-group col-6 mx-auto">
                            <%=  ff.label :"Choisir un mot de passe :"%>
                            <%=  ff.password_field :password, class:"form-control mb-4"%>
                        </div>

                        <div class="form-group col-6 mx-auto">
                            <%=  ff.label :"Confirmer le mot de passe :"%>
                            <%=  ff.password_field :password_confirmation, class:"form-control mb-5"%>
                        </div>

                <% end %>


                <hr class="my-2">



                <% end %>

            </div>


            </div>

            

            
            <div class="row justify-content-between mb-3">
                <%= link_to "Précédent", wizard_path(:problem_type), class:"btn btn-primary" %>
                <%= f.submit "Suivant", class:"btn btn-primary" %>
                <% end %>
            </div> 

        </div>







            
    
</section>

<% end %>

<%= javascript_include_tag "https://maps.googleapis.com/maps/api/js?libraries=places&key=#{ENV['GOOGLE_API_SERVER_KEY']}" %>

<%= javascript_tag ("google.maps.event.addDomListener(window, 'load', function() {
    initializeAutocomplete('autocomplete_address');
});") %>

<%= javascript_tag ("reloadPage()") %>
